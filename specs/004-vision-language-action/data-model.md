# Data Model: Vision-Language-Action (VLA)

## Key Entities

### VoiceCommand

Represents a spoken user command captured as audio for processing.

| Field | Type | Description |
|-------|------|-------------|
| `command_id` | string | Unique identifier (UUID) for the command |
| `audio_data` | bytes | Raw audio data captured from microphone |
| `sample_rate` | int | Audio sample rate (Hz), typically 16000 |
| `duration_ms` | int | Duration of the audio clip in milliseconds |
| `timestamp` | datetime | When the command was captured |
| `transcription` | string | Text transcription from Whisper (null until processed) |
| `confidence_score` | float | Whisper's confidence in transcription (0.0-1.0) |
| `language` | string | Detected language code (e.g., "en") |
| `noise_level_db` | float | Estimated ambient noise level during capture |

---

### ParsedIntent

Structured representation of user intent extracted from transcription.

| Field | Type | Description |
|-------|------|-------------|
| `intent_id` | string | Unique identifier (UUID) |
| `source_command_id` | string | Reference to source VoiceCommand |
| `intent_type` | enum | One of: NAVIGATION, MANIPULATION, QUERY, CANCEL, UNKNOWN |
| `action_verb` | string | Primary action verb (e.g., "go", "pick", "find") |
| `target_object` | string | Target object name (e.g., "cup", "ball") |
| `target_location` | string | Target location name (e.g., "kitchen", "table") |
| `modifiers` | array[string] | Descriptive modifiers (e.g., "red", "large", "carefully") |
| `urgency` | enum | One of: LOW, NORMAL, HIGH |
| `parse_confidence` | float | Confidence in parsing (0.0-1.0) |

---

### ActionPlan

A structured sequence of robot actions generated by the LLM planner.

| Field | Type | Description |
|-------|------|-------------|
| `plan_id` | string | Unique identifier (UUID) |
| `source_intent_id` | string | Reference to source ParsedIntent |
| `primitives` | array[ActionPrimitive] | Ordered list of action primitives |
| `estimated_duration_s` | float | Estimated total execution time |
| `preconditions` | array[string] | Required preconditions for plan execution |
| `created_at` | datetime | When the plan was created |
| `llm_model` | string | LLM model used for planning |
| `plan_status` | enum | One of: PENDING, EXECUTING, COMPLETED, FAILED, CANCELLED |
| `current_step_index` | int | Index of currently executing primitive |

---

### ActionPrimitive

A single executable robot action with defined parameters.

| Field | Type | Description |
|-------|------|-------------|
| `primitive_id` | string | Unique identifier (UUID) |
| `action_type` | enum | One of defined primitive types (see below) |
| `parameters` | object | Type-specific parameters |
| `preconditions` | array[string] | Conditions that must be true before execution |
| `expected_outcomes` | array[string] | Expected results after successful execution |
| `timeout_s` | float | Maximum execution time |
| `retry_count` | int | Number of retries on failure (default: 3) |
| `status` | enum | One of: PENDING, EXECUTING, SUCCEEDED, FAILED, SKIPPED |
| `error_message` | string | Error message if failed |

#### Primitive Types

| Type | Parameters | Description |
|------|-----------|-------------|
| `navigate_to` | `{location: str, pose: Pose}` | Navigate to named location or pose |
| `look_at` | `{target: str, direction: Vector3}` | Orient sensors toward target |
| `scan_environment` | `{area: str, mode: str}` | Perform environmental scan |
| `identify_object` | `{object_name: str, category: str}` | Detect and localize object |
| `pick_up` | `{object_id: str, grasp_type: str}` | Grasp and lift object |
| `place` | `{location: str, pose: Pose}` | Place held object |
| `say` | `{text: str, priority: str}` | Speak text via TTS |
| `wait` | `{duration: float, condition: str}` | Pause execution |
| `cancel` | `{}` | Cancel current action |

---

### TaskContext

Environmental and state information used by the LLM for planning.

| Field | Type | Description |
|-------|------|-------------|
| `context_id` | string | Unique identifier (UUID) |
| `robot_pose` | Pose | Current robot position and orientation |
| `gripper_state` | enum | One of: OPEN, CLOSED, HOLDING |
| `held_object_id` | string | ID of currently held object (null if none) |
| `detected_objects` | array[DetectedObject] | Objects visible to perception |
| `known_locations` | array[NamedLocation] | Named locations in environment |
| `battery_level` | float | Robot battery percentage (0.0-1.0) |
| `active_capabilities` | array[string] | Currently available robot capabilities |
| `recent_history` | array[ExecutionResult] | Last N execution results |
| `updated_at` | datetime | Last context update time |

---

### DetectedObject

An object detected by the perception system.

| Field | Type | Description |
|-------|------|-------------|
| `object_id` | string | Unique identifier for this detection |
| `name` | string | Object class name (e.g., "cup", "phone") |
| `confidence` | float | Detection confidence (0.0-1.0) |
| `pose` | Pose | Object position and orientation in world frame |
| `bounding_box` | BoundingBox3D | 3D bounding box dimensions |
| `color` | string | Dominant color (if applicable) |
| `graspable` | bool | Whether object can be grasped |
| `last_seen` | datetime | When object was last detected |

---

### ExecutionResult

The outcome of an action or plan execution.

| Field | Type | Description |
|-------|------|-------------|
| `result_id` | string | Unique identifier (UUID) |
| `source_id` | string | Reference to ActionPlan or ActionPrimitive |
| `success` | bool | Whether execution succeeded |
| `status_code` | int | Numeric status code |
| `error_type` | enum | Type of error if failed |
| `error_message` | string | Human-readable error description |
| `start_time` | datetime | When execution started |
| `end_time` | datetime | When execution completed |
| `actual_duration_s` | float | Actual execution duration |
| `feedback_messages` | array[string] | Feedback messages during execution |
| `return_data` | object | Action-specific return data |

---

## ROS 2 Message Types

### Custom Messages (vla_msgs)

```
# VoiceCommand.msg
std_msgs/Header header
string command_id
uint32 sample_rate
float32 duration_ms
string transcription
float32 confidence_score
string language

# ParsedIntent.msg
std_msgs/Header header
string intent_id
string source_command_id
string intent_type
string action_verb
string target_object
string target_location
string[] modifiers
string urgency
float32 parse_confidence

# ActionPrimitive.msg
string primitive_id
string action_type
string parameters_json
string[] preconditions
string[] expected_outcomes
float32 timeout_s
uint8 retry_count

# ActionPlan.msg
std_msgs/Header header
string plan_id
string source_intent_id
vla_msgs/ActionPrimitive[] primitives
float32 estimated_duration_s
string[] preconditions
string plan_status
uint8 current_step_index
```

---

## State Transitions

### VoiceCommand State

```
CAPTURING → CAPTURED → TRANSCRIBING → TRANSCRIBED → PARSED
                                  ↓
                               FAILED
```

### ActionPlan State

```
PENDING → VALIDATING → EXECUTING → COMPLETED
              ↓           ↓
           INVALID     FAILED → REPLANNING → EXECUTING
                          ↓
                      CANCELLED
```

### ActionPrimitive State

```
PENDING → EXECUTING → SUCCEEDED
              ↓
          FAILED → RETRYING → EXECUTING
              ↓
          SKIPPED
```

---

## Validation Rules

### VoiceCommand

- `audio_data` must not be empty
- `sample_rate` must be 8000, 16000, or 44100 Hz
- `duration_ms` must be between 100ms and 30000ms
- `confidence_score` must be between 0.0 and 1.0

### ParsedIntent

- `intent_type` must be a valid enum value
- At least one of `target_object` or `target_location` should be non-empty for action intents
- `parse_confidence` must be between 0.0 and 1.0

### ActionPlan

- `primitives` must contain at least one primitive
- `primitives` must have all preconditions satisfiable
- `estimated_duration_s` must be positive
- All primitive IDs must be unique within a plan

### ActionPrimitive

- `action_type` must be a supported primitive type
- `parameters` must match the schema for the action type
- `timeout_s` must be positive and reasonable (<600s)
- `retry_count` must be between 0 and 10
